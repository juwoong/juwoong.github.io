---
import { Image } from "astro:assets";

interface Props {
  src: ImageMetadata;
  alt?: string;
  caption?: string;
  priority?: boolean;
}

const { src, alt = "", caption, priority = false } = Astro.props;
const isLandscape = src.width > src.height;
const optimizedWidth = isLandscape ? 720 : 480;
---

<figure class:list={["figure", { landscape: isLandscape }]}>
  <Image src={src} alt={alt || caption || ""} width={optimizedWidth} loading={priority ? "eager" : "lazy"} decoding="async" />
  {caption && <figcaption>{caption}</figcaption>}
</figure>

<style>
  .figure {
    margin: 1.5em 0;
    text-align: center;
  }

  .figure :global(img) {
    max-width: 480px;
    width: 100%;
    height: auto;
    border-radius: 8px;
  }

  .figure.landscape :global(img) {
    max-width: 100%;
  }

  .figure figcaption {
    margin-top: 0.5em;
    font-size: 0.9em;
    color: rgb(var(--gray));
  }
</style>
